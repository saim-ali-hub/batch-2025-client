#!/bin/bash

echo -e "\n\e[36mLINOOP TEK INNOVATIONS CONFGIURATION TOOL STARTING\nKEEP CALM AND SIT TIGHT\e[0m"
echo -e "\n\e[37m***********************RUNNING NOW******************************\n\e[0m"

: ' This Script configures environemnt and make machine ready
    - changing_rootpw_repos_chrony             --DONE
    - changing_other_configurations     --DONE
  '

if [ `id -u` != 0 ];then
        echo ""
        echo -e "\e[31mFailed: Please Run this Script as root\e[0m\n"
        exit 1
fi
#------------------------------------------------------------------------------------------------
changing_rootpw_repos_chrony() {
echo "RUNNING TASK 1 ......................."
rm -rf /etc/yum.repos.d/*.repo
rm -rf /etc/yum.repos.d/*

echo "RUNNING TASK 2 ......................."
#Uninstall chrony and remove server line from /etc/chrony.conf
sed -i '/^server[[:space:]]\+.*iburst/d' /etc/chrony.conf 2>/dev/null
systemctl disable chronyd --now 2>/dev/null
dnf remove -y chrony &>/dev/null

echo "RUNNING TASK 3 ......................."
echo "complex_abc_1245*abc!!!!!" | passwd --stdin root
echo "REBOOTING YOUR SYSTEM"
sleep 0
shutdown -r now
}
changing_other_configurations(){
echo "RUNNING TASK 4 ......................."
yum -y remove nfs-utils autofs > /dev/null 2>&1

echo "RUNNING TASK 5 ......................."
userdel -r user1

echo "RUNNING TASK 6 ......................."
groupdel developers
userdel -r max
userdel -r bob
userdel -r chris

echo "RUNNING TASK 7 ......................."
EDITOR="sed -i '/^%developers/d'" visudo
sed -i '/^umask\b/d' /home/bob/.bashrc
chage -d "" -E -1 max
sudo sed -i 's/^PASS_MAX_DAYS.*/PASS_MAX_DAYS   99999/' /etc/login.defs
dnf groupremove -q "RPM Development Tools" -y &>/dev/null

echo "RUNNING TASK 8 ......................."
yum -q -y install httpd >/dev/null 2>&1
systemctl enable http --now >/dev/null 2>&1
systemctl stop httpd &>/dev/null
sed -i 's/^Listen .*/Listen 82/' /etc/httpd/conf/httpd.conf &>/dev/null
if semanage port -l | grep -q '^http_port_t.*82'; then
    semanage port -d -t http_port_t -p tcp 82 &>/dev/null
fi
firewall-cmd --remove-port=82/tcp --permanent &>/dev/null
firewall-cmd --reload &>/dev/null

echo "RUNNING TASK 9 ......................."
rm -rf /web1 &>/dev/null
mkdir -p /web1
echo "I am Enjoying RHCSA preparation" > /web1/index.html
sed -i 's|^DocumentRoot .*|DocumentRoot "/web1"|' /etc/httpd/conf/httpd.conf &>/dev/null
sed -i '0,/<Directory "\/var\/www">/s#<Directory "/var/www">#<Directory "/web1">#' /etc/httpd/conf/httpd.conf &>/dev/null
systemctl restart httpd &>/dev/null
}
